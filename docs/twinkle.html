



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="ROBOTS" content="NOINDEX,NOFOLLOW,NOARCHIVE">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>またたき回路 &mdash; Nichiden 0.9 RC ドキュメント</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  

  
        <link rel="index" title="索引"
              href="genindex.html"/>
        <link rel="search" title="検索" href="search.html"/>
    <link rel="top" title="Nichiden 0.9 RC ドキュメント" href="index.html"/>
        <link rel="next" title="配線" href="haisen.html"/>
        <link rel="prev" title="無線制御(Acrabの実装解説)" href="wireless/acrab-code.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-102450326-2', 'auto');
    ga('send', 'pageview');
  </script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Nichiden
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">最近更新した記事</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="honban.html">【直前特集】本番で気をつけたいこと</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/electronic-design.html">回路設計のためのソフトウェア</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/windows.html">無料でWindowsを手に入れる</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/visualstudio.html">Visual Studioをはじめよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="haisen-kagoshii.html">配線(かごしい内)</a></li>
</ul>
<p class="caption"><span class="caption-text">目次</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main.html">東京大学地文研究会天文部 日電引き継ぎ</a></li>
<li class="toctree-l1"><a class="reference internal" href="management.html">プロジェクト マネジメント</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/kikou.html">日周緯度変(日周緯度変換機構)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/saitama.html">日周緯度変(さいたま)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/ikebukuro.html">日周緯度変(Ikebukuro)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/pc-software.html">日周緯度変(外部制御アプリ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/pc-software-history.html">日周緯度変(外部制御アプリの歴史)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nissyu-idohen/pc-software-code.html">日周緯度変(Ogoseの実装解説)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wireless/wireless.html">無線制御</a></li>
<li class="toctree-l1"><a class="reference internal" href="wireless/piscium.html">無線制御(PISCIUM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wireless/acrab.html">無線制御(Acrab)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wireless/acrab-code.html">無線制御(Acrabの実装解説)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">またたき回路</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">概要</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">原理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">自然のゆらぎ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">間欠カオス法</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">回路</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">スイッチ類</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">またたき制御部</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">またたき出力部</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">過電圧保護回路</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">プログラム</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#twinkle-h">Twinkle.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="#twinkle-cpp">Twinkle.cpp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#port-shift">port_shift()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#refresh">refresh()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#chaos-gen-y">chaos_gen(y)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate">generate()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#twinkle-ino">Twinkle.ino</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#isr-int0-vect">ISR(INT0_vect)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#isr-timer0-compa-vect">ISR(TIMER0_COMPA_vect)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#main">main()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">書き込むには</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="haisen.html">配線</a></li>
<li class="toctree-l1"><a class="reference internal" href="haisen-kagoshii.html">配線(かごしい内)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bihin.html">備品管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="syutou.html">主投影機との連携</a></li>
<li class="toctree-l1"><a class="reference internal" href="hojotou.html">補助投影機との連携</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/buy_parts.html">部品の買い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/electronic-design.html">回路設計のためのソフトウェア</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/microcontroller.html">マイコンをはじめよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/editor.html">テキストエディタを使ってみよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/visualstudio.html">Visual Studioをはじめよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="begginers/windows.html">無料でWindowsを手に入れる</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nichiden</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Nichiden</a> &raquo;</li>
        
      <li>またたき回路</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/twinkle.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <p><a style="font-size:32px;color:red" href="honban.html">【直前特集】本番で気をつけたいこと</a></p>
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>またたき回路<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<ul class="simple">
<li>書いた人: Kenichi Ito(nichiden_27)</li>
<li>更新日時: 2017/03/25</li>
<li>実行に必要な知識・技能: 電子回路、AVRマイコン</li>
<li>タスクの重さ: 3/数週間</li>
<li>タスクの必須度: 2/たまにやるべき</li>
<li>元資料</li>
<li><code class="docutils literal"><span class="pre">一等星投影機付属またたき回路仕様書.docx</span></code> by 西村陽樹(nichiden_23)</li>
</ul>
<div class="section" id="id2">
<h2>概要<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>いっとうはただ明るいだけでなく、またたいているように見える効果が付いています。
そのための「またたき回路」の開発は日電に委託されており、遅くとも20主投の頃から存在していました。
現行の回路は23が作ったもので、プログラムは27で改造したものです。</p>
</div>
<div class="section" id="id3">
<h2>原理<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>またたきの再現には様々な方法が考えられるが、ここでは20代から現在まで使われている「<strong>1/fゆらぎ</strong>」と「<strong>間欠カオス法</strong>」による方法を解説する。</p>
<div class="section" id="id4">
<h3>自然のゆらぎ<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>またたきのパターンは周期的ではなく、ランダムであるべきだということは直感的にわかるだろう。
ただし、日電が用いたのは完全な乱数ではなく、自然の「ゆらぎ」を擬似的に再現したものである。</p>
<p>恒星のまたたきは、大気の「ゆらぎ」による光の強弱の変化と説明できる。
ゆらぎ(fluctuation)とは、ある量が平均値からずれる現象である。
なかでも、<strong>1/fゆらぎ</strong>
は自然現象によくみられ、星のまたたきもこれに分類される。</p>
<p>電子回路などにおけるゆらぎはノイズとして表れる。
ノイズは周波数特性(パワースペクトルと周波数の関係)によって分類されているが、1/fゆらぎによるノイズは<strong>ピンクノイズ</strong>
と呼ばれる。
ピンクノイズはパワーと周波数が反比例しており、高周波成分であるほど弱い。
これを可視光に当てはめると波長の長い色が残り、ピンク色に見えるというわけだ。</p>
</div>
<div class="section" id="id5">
<h3>間欠カオス法<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>従って、いっとうの明るさを1/fゆらぎに近いパターンで変化させればまたたきが再現できる。
1/fゆらぎをプログラムで生成する方法はいくつかあるが、またたき回路では処理の軽い「<strong>間欠カオス法</strong>」が用いられてきた。
これは、漸化式によって擬似乱数を作り出す方法である。
以下に基本となる式を示す。</p>
<div class="math">
\[\begin{split}\begin{aligned}
    \begin{cases}
        X(t＋1)=X(t)+2X(t)^{2} &amp; (X(t)&lt;0.5)\\
        X(t＋1)=X(t)-2(1－X(t))^{2} &amp; (X(t)\geqq 0.5 )
    \end{cases}
\end{aligned}\end{split}\]</div>
<p>ただし、実はこのままではこの式はあまり実用的でない。
まず、<code class="docutils literal"><span class="pre">X(t)＝0.5</span></code>の場合、以降のXの値は0に張り付いてしまう。
また、0と1の近傍では値の変化が小さくなりすぎる問題もある。</p>
<p>そこで、実際のプログラムでは上限と下限の付近で若干値をいじるようになっている。
また10進数の浮動小数点演算はマイコンでは時間がかかりすぎるので、実際には<code class="docutils literal"><span class="pre">double</span></code>型ではなく<code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span></code>型(32bit長整数)の値としてある。</p>
</div>
</div>
<div class="section" id="id6">
<h2>回路<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>北天用と南天用の二つが現存する。
回路は全く同じで、プログラムだけが違う。</p>
<p>電源電圧はマイコン、投影機共に5V。
回路には<strong>過電圧保護回路</strong>があり、約5.2Vを超える電圧を印加すると電流を遮断する。
これは、いっとう以外の投影機の電源電圧が12Vであり、刺し間違いによる故障を避けるためである。
耐圧は15V程度の設計であるため、24Vなどの高電圧をかけると保護回路が破損する危険がある。</p>
<div class="figure" id="id13">
<img alt="またたき回路の回路図" src="_images/twinkle-circuit.png" />
<p class="caption"><span class="caption-text">またたき回路の回路図</span></p>
</div>
<p>回路図を掲載する。
<strong>電源部</strong>(過電圧保護部)、<strong>またたき制御部</strong>(マイコン)、<strong>またたき出力部</strong>(トランジスタアレイ、DCジャック)が主だった構成である。</p>
<div class="section" id="id7">
<h3>スイッチ類<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="figure" id="id14">
<img alt="またたき回路の外観" src="_images/twinkle-appearance.jpg" />
<p class="caption"><span class="caption-text">またたき回路の外観</span></p>
</div>
<p>トグルスイッチ(<code class="docutils literal"><span class="pre">SW2</span></code>)が、<strong>またたきのON/OFFスイッチ</strong> である。
OFFにすると消灯するわけではなく、またたきの効果のない常時点灯となる。
いっとうユニット自体のテストやデバッグに使用することを想定している。</p>
<p>スイッチの近くに設置されたLEDはまたたきの確認用である。
横のジャンパピンを外すと消灯するので、上映中は外しておくとよい。</p>
<p>タクトスイッチは<strong>リセットスイッチ</strong>で、押すとマイコンが再起動する。</p>
</div>
<div class="section" id="id8">
<h3>またたき制御部<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">ATTiny861A</span></code>を使用している。
<code class="docutils literal"><span class="pre">SW2</span></code>がpin9(<code class="docutils literal"><span class="pre">INT0/PB6</span></code>)に繋がれており、INT0割り込みを使用してまたたきON/OFFを切り替える。</p>
<p>INT割り込みはI/Oポートが出力設定になっていても機能するので、プログラムでは<code class="docutils literal"><span class="pre">PB6</span></code>が出力設定になっていても問題ない。
また、ON/OFFの制御をするだけのスイッチであるためチャタリング除去はなされていない。</p>
<p><code class="docutils literal"><span class="pre">PB0</span></code>、<code class="docutils literal"><span class="pre">PA0</span></code>に確認用LEDが接続されている。</p>
</div>
<div class="section" id="id9">
<h3>またたき出力部<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">TD62003</span></code>トランジスタアレイを使用する。
<code class="docutils literal"><span class="pre">ATTiny861A</span></code>の<code class="docutils literal"><span class="pre">PA0-PA5</span></code>/<code class="docutils literal"><span class="pre">PB0-PB5</span></code>の12本が出力ピンとなる。
いっとうとの接続部はφ2.5の基板用DCジャックを使っている。
各出力ピンが<code class="docutils literal"><span class="pre">HIGH</span></code>になると、対応したDCジャックのGNDが導通して電流が流れる仕組みである。</p>
</div>
<div class="section" id="id10">
<h3>過電圧保護回路<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>23製作時に、こうとうユニットの電源電圧が12Vであったことから急遽設置された。
電源を12Vに統一して三端子レギュレータで5Vにするアイデアもあり、作り変えの際には考慮されたい。</p>
<div class="figure" id="id15">
<img alt="過電圧保護回路" src="_images/twinkle-protection.png" />
<p class="caption"><span class="caption-text">過電圧保護回路</span></p>
</div>
<p>閾値の検出に使用しているのは<strong>ツェナーダイオード</strong>である。
ダイオードには、逆方向に電圧をかけるとある閾値以上の電位差で逆向きに電流が流れ、それ以上電位差が大きくならない効果がある。
その閾値をツェナー電圧という。</p>
<p>通常のダイオードでは非常に高いツェナー電圧だが、ツェナーダイオードは不純物を混ぜることでツェナー電圧を下げている。
またたき回路で使用した<code class="docutils literal"><span class="pre">HZ5B1</span></code>のツェナー電圧は4.6-4.8V。
カソード側の200Ωの抵抗により、回路全体としての閾値を<strong>5.1-5.2V</strong>としてある。</p>
<p><code class="docutils literal"><span class="pre">VCC_IN</span></code>が約5.1V以下の場合、ツェナーダイオードには電流が流れず、<code class="docutils literal"><span class="pre">2SA1015GR</span></code>はOFFの状態になる。
<code class="docutils literal"><span class="pre">2SA1015GR</span></code>のコレクタはプルダウンされているので0Vに落ち、FET(<code class="docutils literal"><span class="pre">2SJ471</span></code>)にはゲート・ソース間電圧が発生する。
従って、FETのソース・ドレイン間に電流が流れ、<code class="docutils literal"><span class="pre">VCC_OUT</span></code>に入力電圧がそのまま出てくる。</p>
<p><code class="docutils literal"><span class="pre">VCC_IN</span></code>が約5.2Ｖを超えると、ツェナーダイオードに逆向きの電流が流れ始める。
<code class="docutils literal"><span class="pre">2SA1015GR</span></code>にエミッタ・ベース電流が流れることで、コレクタに電流が流れて<code class="docutils literal"><span class="pre">2SJ471</span></code>のゲート電圧が<code class="docutils literal"><span class="pre">VCC_IN</span></code>とほぼ等しくなる。
結果、ゲート・ソース間電圧はほぼ0Vとなり、FETがOFFの状態になって電源が遮断される。</p>
<p>この回路の耐圧はツェナーダイオードの許容損失による。
入力が約15Vを越えると許容損失を超え、ダイオードが焼き切れる可能性がある。
仮に焼ききれた場合、ツェナーダイオードに電流が流れない状態と同じになり、入力電圧が<code class="docutils literal"><span class="pre">VCC_OUT</span></code>に出力されてしまう。
大変危険なので、<strong>高電圧の電源を接続しないよう注意すべきだ</strong>。</p>
<p>保護回路の閾値は、ツェナーダイオードのツェナー電圧やカソード側の抵抗値を調整することで変更できる。</p>
</div>
</div>
<div class="section" id="id11">
<h2>プログラム<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>27でプログラムを改修した際、Arduino
IDEを使用してビルドと書き込みを行った。 Arduino
IDEではメインのソースファイルは.inoという拡張子のファイルになる。
ただし、ベースはC++なので.cppや.hのファイルに分割して記述しても問題ない。</p>
<p>23日電のまたたき回路のプログラムでは<strong>マイコンを実際に動作させる部分</strong>と<strong>またたきパターンを生成する部分</strong>が混在していた。
可読性を高める目的で、前者を<code class="docutils literal"><span class="pre">Twinkle.ino</span></code>に、後者を<code class="docutils literal"><span class="pre">Twinkle.cpp</span></code>及び<code class="docutils literal"><span class="pre">Twinkle.h</span></code>と分けることにした。</p>
<p><code class="docutils literal"><span class="pre">Twinkle.h</span></code>で宣言している<code class="docutils literal"><span class="pre">Twinkle</span></code>クラスがパターン生成のライブラリのように使えることを目指したが、完全なブラックボックスにはできていないので適宜改善が必要。</p>
<div class="section" id="twinkle-h">
<h3>Twinkle.h<a class="headerlink" href="#twinkle-h" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>プログラム中で使う変数・関数の宣言があるファイル。
<code class="docutils literal"><span class="pre">NORTH_HEMISPHERE</span></code>や<code class="docutils literal"><span class="pre">SOUTH_HEMISPHERE</span></code>がdefineされているが、これは北天・南天で数値を切り替えるために用いる。
書き込み前によく確かめて、不要な方をコメントアウトすること(片方をコメントにしていないと、変数宣言が二重となりエラーが出る)。</p>
<p>使っている変数や配列の注釈を箇条書きしておこう。</p>
<ul class="simple">
<li>public変数<ul>
<li>int bit_num[6]:
パターンの番号とマイコン側のピンの順番の対応を示す</li>
<li>unsigned int on[12]:
27で追加した、またたきをピンごとに無効化するための配列。1か0</li>
<li>unsigned int on_duration[12]:
一周期のうちLEDが点灯している時間(=またたきパターン)を格納する</li>
</ul>
</li>
<li>private変数<ul>
<li>unsigned long shift_chaos: ピン同士を入れ替える際に使う乱数値</li>
<li>unsigned long chaos[12]: またたきパターン用の乱数値</li>
<li>unsigned int min_duration[12]:
on_durationの最小値。大きくするとまたたき効果が強くなる</li>
<li>unsigned int refresh_rate/rr_count/shift_rate/sr_count: (後述)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="twinkle-cpp">
<h3>Twinkle.cpp<a class="headerlink" href="#twinkle-cpp" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>冒頭でいくつか記号定数が宣言されている。
コメントを読めば概ね理解できるであろう。
結局<code class="docutils literal"><span class="pre">Twinkle</span></code>クラスの内部処理で使うだけなので、ヘッダファイルのクラス宣言の方に書いても問題なかったかも。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cp">#define CHAOS_DIV 256 </span><span class="c1">// chaos_gen()で生成される乱数は1~32768の幅であるが、このままではタイマ0割込に使用できないので適当な2の乗数で割る</span>
<span class="cp">#define ON_DURATION_MAX 160 </span><span class="c1">// LEDの点灯時間の最大値を決定するパラメーター(タイマ割込の間隔によって決まっているのでオシロスコープで波形を見ながら調整のこと)</span>
<span class="cp">#define TWINKLE_RATE 2 </span><span class="c1">// またたき用の乱数値の更新レート、nを設定するとn回のタイマ割込に1回の割合で値が更新する</span>
<span class="cp">#define TWINKLE_SHIFT 100 </span><span class="c1">// 乱数の周期性問題を解決するために、乱数とそれに対応する信号出力ビットをport_shift()で変更している。nを設定するとn回の乱数更新に1回の割合で出力がビットシフトする</span>
</pre></div>
</div>
<p>次に、コンストラクタがある。
と言っても変数の初期化をしているだけである。
ここで、<code class="docutils literal"><span class="pre">refresh_rate</span></code>や<code class="docutils literal"><span class="pre">shift_rate</span></code>などを設定する。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">Twinkle</span><span class="o">::</span><span class="n">Twinkle</span><span class="p">()</span><span class="o">:</span><span class="n">refresh_rate</span><span class="p">(</span><span class="n">TWINKLE_RATE</span><span class="p">),</span>
                   <span class="n">rr_count</span><span class="p">(</span><span class="n">TWINKLE_RATE</span><span class="p">),</span>
                   <span class="n">shift_rate</span><span class="p">(</span><span class="n">TWINKLE_SHIFT</span><span class="p">),</span>
                   <span class="n">sr_count</span><span class="p">(</span><span class="n">TWINKLE_SHIFT</span><span class="p">){};</span>
</pre></div>
</div>
<div class="section" id="port-shift">
<h4>port_shift()<a class="headerlink" href="#port-shift" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>間欠カオス法はあくまで擬似乱数なので、周期性が目立つことがある(らしい)。
定期的にまたたきパターンと各出力ピンの対応を変えることで、これを防ぐ。</p>
<p><strong>ただし、このメソッドは現在使用していない。</strong>
23では12のピンを強弱2種類にしか分けていなかったが、27で惑星(またたかない)を追加したのでこれが3種類に増えた。
当初それに気づかず実験したところ、またたき強・弱・惑星が数秒で入れ替わってしまう。
修正の時間も限られており、本番ではポートの入れ替えを使わずに投影をすることとなった。
見ていた限りでは特に不自然には感じなかったが、この仕様が必要かどうかは更なる検証を待ちたい。</p>
<p>参考のためにピンを入れ替える仕組みを解説する。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">bit_num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bit_num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">shift_chaos</span> <span class="o">&gt;=</span> <span class="mi">12000</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">4</span><span class="p">))</span> <span class="o">%</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// 6要素の数列を左に回転シフト</span>
</pre></div>
</div>
<p>回転シフトは、配列の中身を押し出して溢れた分を逆側に追加するものだ。
円環状に並んだ数字を回転させるイメージである。
アルゴリズムとしてはある数字(6要素なら1~5)を足し、6以上になった要素からは6を引くというものだ。
6で割った余りを保ったまま6を下回ればいいので、<strong>実は割り算して余りをとるだけでもいい。</strong></p>
<p>なお、23の計測によるこの処理の実行時間は100μsだが、割り算の方法で処理を簡略化したので短くなったかもしれない。</p>
</div>
<div class="section" id="refresh">
<h4>refresh()<a class="headerlink" href="#refresh" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>またたきパターンの更新を行う。
<code class="docutils literal"><span class="pre">chaos</span></code>の12個の要素それぞれに、新たな乱数値を格納している。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">Twinkle</span><span class="o">::</span><span class="n">refresh</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span> <span class="c1">// 乱数値を更新する。所要時間は12変数で1ms</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">SIZE_OF</span><span class="p">(</span><span class="n">on_duration</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">chaos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chaos_gen</span><span class="p">(</span><span class="n">chaos</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">on_duration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">chaos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHAOS_DIV</span> <span class="o">+</span> <span class="n">min_duration</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">ON_DURATION_MAX</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>実際のまたたきパターンで使う<code class="docutils literal"><span class="pre">on_duration</span></code>には、<code class="docutils literal"><span class="pre">chaos</span></code>から二つの変化を加える。
まず、最大32768の出力を<code class="docutils literal"><span class="pre">CHAOS_DIV</span></code>で除した上で、<code class="docutils literal"><span class="pre">min_duration</span></code>という数を加えている。
<code class="docutils literal"><span class="pre">min_duration</span></code>が大きいほど、<strong>LEDが点灯している時間が増え、またたきの効果が薄まる</strong>。</p>
<p>また、<code class="docutils literal"><span class="pre">on_duration</span></code>は160を超えてはいけないので、<code class="docutils literal"><span class="pre">ON_DURATION_MAX</span></code>と比較して小さい方を採用する。
実行時間は1msらしい。</p>
</div>
<div class="section" id="chaos-gen-y">
<h4>chaos_gen(y)<a class="headerlink" href="#chaos-gen-y" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>入力yに対して間欠カオス法による擬似乱数を一個出力する。
元の漸化式にアレンジを加え、yの変化が微小になることがないよう調整してある。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Twinkle</span><span class="o">::</span><span class="n">chaos_gen</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">y</span><span class="p">){</span> <span class="c1">// Max == 32768までの整数値を返す疑似乱数(1/fゆらぎ)</span>
  <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">1638</span><span class="p">)</span> <span class="n">y</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32768</span> <span class="o">+</span> <span class="mi">1966</span><span class="p">;</span>
  <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">16384</span><span class="p">)</span> <span class="n">y</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32768</span><span class="p">;</span>
  <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">31129</span><span class="p">)</span> <span class="n">y</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="mi">32768</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32768</span> <span class="o">+</span> <span class="mi">1310</span><span class="p">;</span>
  <span class="k">else</span> <span class="n">y</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="mi">32768</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32768</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="generate">
<h4>generate()<a class="headerlink" href="#generate" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>またたき生成や出力ピンの入れ替えを制御する。
タイマ割り込みで毎回呼ばれることを想定している。</p>
<p>割り込みが入るたびに<code class="docutils literal"><span class="pre">rr_count</span></code>と<code class="docutils literal"><span class="pre">sr_count</span></code>が1ずつ減少し、0になると<code class="docutils literal"><span class="pre">port_shift()</span></code>や<code class="docutils literal"><span class="pre">refresh()</span></code>を実行する。
ただし、27の仕様変更で<code class="docutils literal"><span class="pre">port_shift()</span></code>は不使用としたので、その部分はコメントになっている。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">Twinkle</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span> <span class="c1">// またたきをつかさどる部分</span>
  <span class="n">rr_count</span><span class="o">--</span><span class="p">;</span> <span class="c1">//乱数更新時期の判定と実行をする</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rr_count</span><span class="p">){</span>
    <span class="n">sr_count</span><span class="o">--</span><span class="p">;</span> <span class="c1">//ビットシフト更新時期の判定と実行をする</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">sr_count</span><span class="p">){</span>
      <span class="c1">//port_shift();</span>
      <span class="n">sr_count</span> <span class="o">=</span> <span class="n">shift_rate</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span> <span class="n">_delay_us</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="n">refresh</span><span class="p">();</span>
    <span class="n">rr_count</span> <span class="o">=</span> <span class="n">refresh_rate</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span> <span class="n">_delay_us</span><span class="p">(</span><span class="mi">1100</span><span class="p">);</span> <span class="c1">//それらの操作をしない場合でも、同じだけの時間waitして調整する</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="twinkle-ino">
<h3>Twinkle.ino<a class="headerlink" href="#twinkle-ino" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>AVRマイコンの制御に直接関連するコードはこちらにまとめた。</p>
<div class="section" id="isr-int0-vect">
<h4>ISR(INT0_vect)<a class="headerlink" href="#isr-int0-vect" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>INT0割り込みで呼ばれる。
PORTAとPORTBをすべてH、つまり常時点灯・またたきなしの状態にする。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ISR</span><span class="p">(</span><span class="n">INT0_vect</span><span class="p">){</span> <span class="c1">//またたきOFF（スイッチで切り替え）</span>
  <span class="n">PORTA</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
  <span class="n">PORTB</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="isr-timer0-compa-vect">
<h4>ISR(TIMER0_COMPA_vect)<a class="headerlink" href="#isr-timer0-compa-vect" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>タイマ0割り込みで呼ばれる。
PORTAとPORTBをすべてHにしてから、Twinkleクラスの<code class="docutils literal"><span class="pre">generate()</span></code>関数を呼んでパターンの更新処理をする。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">PORTA</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="n">PORTB</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="n">twinkle</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c_up</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>以降は、実際にピンから出力するコードになる。
<code class="docutils literal"><span class="pre">pattern_count</span></code>は出力ピンの数(現状12)を表す。</p>
<p>forループ内では、7μsごとに<code class="docutils literal"><span class="pre">c_up</span></code>をインクリメント(コメントに<code class="docutils literal"><span class="pre">twinkle.c_up</span></code>とあるがこれはミス)していく。
<code class="docutils literal"><span class="pre">twinkle.on_duration[i]</span></code>と一致したら<code class="docutils literal"><span class="pre">pattern_count</span></code>を一つ減らして、<code class="docutils literal"><span class="pre">twinkle.on[i]</span></code>が0でなければLEDを消灯する。
<code class="docutils literal"><span class="pre">i</span></code>とピン番号の対応は<code class="docutils literal"><span class="pre">twinkle.bit_num</span></code>に書いてある。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pattern_count</span> <span class="o">=</span> <span class="n">SIZE_OF</span><span class="p">(</span><span class="n">twinkle</span><span class="p">.</span><span class="n">on_duration</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="n">pattern_count</span><span class="p">){</span> <span class="c1">//twinkle.on_durationの値とtwinkle.c_up（カウントアップ）の値を比較し、一致するまではON、一致したらLEDをOFFにする。全部OFFになったらループを抜けてmainに戻る。</span>
  <span class="n">c_up</span><span class="o">++</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">SIZE_OF</span><span class="p">(</span><span class="n">twinkle</span><span class="p">.</span><span class="n">on_duration</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">twinkle</span><span class="p">.</span><span class="n">on_duration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">c_up</span><span class="p">){</span>
      <span class="n">pattern_count</span><span class="o">--</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">twinkle</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="n">PORTA</span> <span class="o">^=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">twinkle</span><span class="p">.</span><span class="n">bit_num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">else</span> <span class="n">PORTB</span> <span class="o">^=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">twinkle</span><span class="p">.</span><span class="n">bit_num</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">6</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">_delay_us</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>出力ポートの制御であるが、マイコンボードのデジタル出力のようには便利でなく、<strong>出力レジスタというものを使う</strong>。
<code class="docutils literal"><span class="pre">PORTA</span></code>や<code class="docutils literal"><span class="pre">PORTB</span></code>とあるのが出力レジスタで、ピンの状態が二進数で保存されている。
これを書き換えることで出力がなされる仕組みだ。</p>
<p>例えば、<code class="docutils literal"><span class="pre">PORTA</span> <span class="pre">=</span> <span class="pre">0xFF(11111111)</span></code>の時に、6番目のピンを<code class="docutils literal"><span class="pre">LOW</span></code>にしたいとする。
<code class="docutils literal"><span class="pre">^=</span></code>演算子はXOR代入といい、右の数との排他的論理和を代入する。
XORは二つの数が違えば1、同じなら0を返すので、<code class="docutils literal"><span class="pre">PORTA</span></code>の6桁目と1のXORを取ればそこだけが0になる。
n桁目が1の数は1を(n-1)ビット左にビットシフトすると作れるので、コードはこうなる。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">PORTA</span> <span class="o">^=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="section" id="main">
<h4>main()<a class="headerlink" href="#main" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>初期設定とメインルーチン。
I/Oポートの設定・タイマ0(CTCモード)とプリスケーラの設定・タイマ0割り込みの設定・INT0割り込みの設定を行っているらしい。
ここを変更したければAVRの勉強をしよう。</p>
<p><code class="docutils literal"><span class="pre">sei()</span></code>は割り込みを許可する組み込み関数である。
設定終了後にこれを呼んで無限ループに入り、割り込みを待つことになる。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
  <span class="cm">/*** 初期設定(TIMER0_CTC、TIMER割込、INT0割込) ***/</span>
  <span class="n">_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="n">DDRA</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="c1">//PORTA0~7を出力に設定</span>
  <span class="n">DDRB</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
  <span class="cm">/*タイマ0 CTCモード、タイマ0_Compare_A割込*/</span>
  <span class="n">TCCR0A</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span> <span class="c1">//CTC0をHに</span>
  <span class="n">TCCR0B</span> <span class="o">=</span> <span class="mh">0x00</span> <span class="o">|</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">CS02</span> <span class="o">|</span> <span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">CS01</span> <span class="o">|</span> <span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">CS00</span><span class="p">;</span>
  <span class="n">OCR0A</span>  <span class="o">=</span> <span class="mi">180</span><span class="p">;</span> <span class="c1">//CTCのMAX値の設定(180、プリスケーラ256の設定でタイマ割込間隔は7.5msec)</span>
  <span class="n">TIMSK</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">OCIE0A</span> <span class="o">|</span> <span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">TOIE0</span><span class="p">;</span> <span class="c1">//タイマ0CompA割込有効</span>
  <span class="n">GIMSK</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">INT0</span><span class="p">;</span> <span class="c1">//INT0割り込み有効</span>
  <span class="n">MCUCR</span> <span class="o">|=</span> <span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">ISC01</span> <span class="o">|</span> <span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">ISC00</span><span class="p">;</span> <span class="c1">//INTピンのLowで割り込み発生</span>
  <span class="n">PORTA</span>  <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
  <span class="n">PORTB</span>  <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
  <span class="cm">/*************************************************/</span>
  <span class="n">sei</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(;;){}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h3>書き込むには<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>書き込みの際、Fuseビットの<code class="docutils literal"><span class="pre">DIVCLK8</span></code>を<code class="docutils literal"><span class="pre">Disable</span></code>する必要がある(内部クロックを1MHzではなく8MHzで使用するため)。</p>
<p>27では、書き込みにArduino IDEを使った。
Arduinoの中身はAVRマイコンなので、マイコン(ボード)の定義を読み込む事で書き込み可能になる。
ボードマネージャで<a class="reference external" href="http://drazzy.com/package_drazzy.com_index.json">設定ファイルのURL</a>を指定すると各種設定が選べるので、<code class="docutils literal"><span class="pre">ATTiny861A</span></code>を選択して書き込もう。</p>
<p>手順の詳細は<a class="reference external" href="http://make.kosakalab.com/make/electronic-work/arduino-ide/attiny-dev/">Arduino IDE に ATtiny45/85/2313
他の開発環境を組み込む</a>など参照。</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="haisen.html" class="btn btn-neutral float-right" title="配線" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wireless/acrab-code.html" class="btn btn-neutral" title="無線制御(Acrabの実装解説)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Nichiden Project.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9 RC',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>